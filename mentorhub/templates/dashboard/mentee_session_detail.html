<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Session Details - CodeMentorHub</title>
    {% load static %}
    <link rel="stylesheet" type="text/css" href="{% static 'css/home.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'css/mentee_dashboard.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'css/user_theme.css' %}">
    <style>
        .detail-layout { max-width: 900px; margin: 0 auto; }
        .card { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 12px rgba(0,0,0,0.08); margin-bottom: 18px; }
        .top-actions { display:flex; align-items:center; justify-content:space-between; gap:12px; flex-wrap:wrap; margin-bottom:10px; }
        .back-link { color:#667eea; text-decoration:none; font-weight:700; }
        .session-meta { display:grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap:14px; }
        .meta-item { background:#f7f7fb; padding:12px; border-radius:8px; }
        .meta-label { font-size:12px; text-transform:uppercase; color:#666; letter-spacing:0.5px; }
        .meta-value { font-weight:700; color:#333; margin-top:4px; }
        .status-pill { display:inline-block; padding:6px 12px; border-radius:20px; font-weight:700; font-size:12px; text-transform:uppercase; }
        .status-completed { background:#e2e3e5; color:#383d41; }
        .status-confirmed { background:#d4edda; color:#155724; }
        .status-pending { background:#fff3cd; color:#856404; }
        .status-cancelled { background:#f8d7da; color:#721c24; }
        .feedback-box { border:1px solid #eee; padding:16px; border-radius:10px; background:#fafafa; }
        .stars { display:flex; gap:6px; font-size:26px; cursor:pointer; }
        .stars input { display:none; }
        .stars label { color:#ddd; transition: color 0.2s ease; }
        .stars label.checked { color:#f5b301; }
        .stars label:hover, .stars label:hover ~ label { color:#f5b301; }
        .btn { display:inline-block; padding:10px 16px; border-radius:8px; text-decoration:none; font-weight:700; }
        .btn-primary { background:#667eea; color:white; }
        .btn-secondary { background:#f1f1f5; color:#333; }
        .review-display { display:flex; align-items:center; gap:8px; font-size:20px; margin-bottom:6px; }
    </style>
</head>
<body>
    {% include 'partials/header.html' %}

    <main>
        <div class="detail-layout">
            <div class="top-actions">
                <a class="back-link" href="{% url 'mentee_dashboard' %}">← Back to My Sessions</a>
                <span class="status-pill status-{{ session.status }}">{{ session.get_status_display }}</span>
            </div>

            <div class="card">
                <h2 style="margin-top:0;">Session with {{ session.mentor.full_name }}</h2>
                <div class="session-meta">
                    <div class="meta-item">
                        <div class="meta-label">Date</div>
                        <div class="meta-value">{{ session.session_date }}</div>
                    </div>
                    <div class="meta-item">
                        <div class="meta-label">Time</div>
                        <div class="meta-value">{{ session.session_time }}</div>
                    </div>
                    <div class="meta-item">
                        <div class="meta-label">Duration</div>
                        <div class="meta-value">{{ session.duration_minutes }} minutes</div>
                    </div>
                    <div class="meta-item">
                        <div class="meta-label">Amount Paid</div>
                        <div class="meta-value">${{ session.amount_paid }}</div>
                    </div>
                </div>

                {% if session.get_meeting_link %}
                <div class="meeting-link" style="margin-top:14px;">
                    <strong>Meeting link</strong><br>
                    <a href="{{ session.get_meeting_link }}" target="_blank">{{ session.get_meeting_link }}</a>
                </div>
                {% endif %}

                {% if session.meeting_notes %}
                <div style="margin-top:12px;">
                    <strong>Notes:</strong> {{ session.meeting_notes }}
                </div>
                {% endif %}
            </div>

            <div class="card">
                <h3 style="margin-top:0;">Feedback</h3>
                {% if feedback %}
                    <div class="feedback-box">
                        <div class="review-display">
                            {% for _ in "12345"|make_list %}
                                <span {% if forloop.counter <= feedback.rating %}style="color:#f5b301;"{% else %}style="color:#ddd;"{% endif %}>★</span>
                            {% endfor %}
                            <span style="font-weight:700;">{{ feedback.rating }}/5</span>
                        </div>
                        {% if feedback.comment %}
                            <div>{{ feedback.comment }}</div>
                        {% else %}
                            <div style="color:#666;">No written feedback provided.</div>
                        {% endif %}
                        <div style="margin-top:8px; color:#777; font-size:12px;">Submitted on {{ feedback.created_at }}</div>
                    </div>
                {% elif can_leave_feedback %}
                    <form method="post" class="feedback-box">
                        {% csrf_token %}
                        <p style="margin-top:0;">Rate your session experience.</p>
                        <div class="stars">
                            <input type="radio" id="star5" name="rating" value="5">
                            <label for="star5" data-value="5">★</label>
                            <input type="radio" id="star4" name="rating" value="4">
                            <label for="star4" data-value="4">★</label>
                            <input type="radio" id="star3" name="rating" value="3">
                            <label for="star3" data-value="3">★</label>
                            <input type="radio" id="star2" name="rating" value="2">
                            <label for="star2" data-value="2">★</label>
                            <input type="radio" id="star1" name="rating" value="1">
                            <label for="star1" data-value="1">★</label>
                        </div>
                        <textarea name="comment" rows="4" placeholder="Optional: share more details" style="width:100%; margin-top:12px; padding:10px; border-radius:8px; border:1px solid #ddd;"></textarea>
                        <div style="margin-top:12px; display:flex; gap:10px; flex-wrap:wrap;">
                            <button type="submit" class="btn btn-primary">Submit feedback</button>
                            <a href="{% url 'mentee_dashboard' %}" class="btn btn-secondary">Skip for now</a>
                        </div>
                    </form>
                {% else %}
                    <div class="feedback-box">
                        <div style="font-weight:700;">Feedback unavailable</div>
                        <p style="margin:6px 0 0 0; color:#666;">You can leave feedback once this session is marked as completed by the admin.</p>
                    </div>
                {% endif %}
            </div>
        </div>
    </main>

    {% include 'partials/footer.html' %}
    <script>
        (function() {
            const container = document.querySelector('.stars');
            if (!container) return;
            const labels = Array.from(container.querySelectorAll('label'));
            const inputs = Array.from(container.querySelectorAll('input[type="radio"]'));
            const paint = (value) => {
                labels.forEach(label => {
                    const lv = Number(label.dataset.value || 0);
                    label.classList.toggle('checked', lv <= value);
                });
            };
            inputs.forEach(input => {
                input.addEventListener('change', () => paint(Number(input.value)));
            });
            const checked = container.querySelector('input:checked');
            if (checked) paint(Number(checked.value));
        })();
    </script>
</body>
</html>

