{% if messages %}
    <div class="messages">
        {% for message in messages %}
            <div class="alert alert-{{ message.tags }}">{{ message }}</div>
        {% endfor %}
    </div>
{% endif %}

<form method="post" id="hireDeveloperForm" novalidate>
    {% csrf_token %}
    {{ form.as_p }}
    <input type="submit" value="Submit">
</form>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('hireDeveloperForm');
    const email = form.querySelector('input[name="email"]');
    const number = form.querySelector('input[name="number"]');
    const deadline = form.querySelector('input[name="deadline"]');
    const projectType = form.querySelector('select[name="project_type"]');

    // Set min date to today for future-only selection
    const today = new Date();
    const yyyy = today.getFullYear();
    const mm = String(today.getMonth() + 1).padStart(2, '0');
    const dd = String(today.getDate()).padStart(2, '0');
    const todayStr = `${yyyy}-${mm}-${dd}`;
    if (deadline) {
        deadline.min = todayStr;
    }

    function validateEmail() {
        if (!email) return true;
        const valid = email.checkValidity();
        email.setCustomValidity(valid ? '' : 'Please enter a valid email address.');
        return valid;
    }

    function validatePhone() {
        if (!number) return true;
        const pattern = /^\+?[0-9\-\s]{7,15}$/;
        const valid = pattern.test(number.value.trim());
        number.setCustomValidity(valid ? '' : 'Enter a valid phone number (7-15 digits).');
        return valid;
    }

    function validateDeadline() {
        if (!deadline || !deadline.value) return false;
        const selected = new Date(deadline.value + 'T00:00:00');
        const todayOnly = new Date(`${todayStr}T00:00:00`);
        const valid = selected > todayOnly; // strictly future
        deadline.setCustomValidity(valid ? '' : 'Please choose a future date.');
        return valid;
    }

    function validateProjectType() {
        if (!projectType) return true;
        const valid = projectType.value !== '';
        projectType.setCustomValidity(valid ? '' : 'Please select a project type.');
        return valid;
    }

    // Live validation on input/change
    if (email) email.addEventListener('input', validateEmail);
    if (number) number.addEventListener('input', validatePhone);
    if (deadline) deadline.addEventListener('change', validateDeadline);
    if (projectType) projectType.addEventListener('change', validateProjectType);

    // On submit, run validations and prevent submission if invalid
    form.addEventListener('submit', function(e) {
        const ok = [validateEmail(), validatePhone(), validateDeadline(), validateProjectType()]
            .every(Boolean);
        if (!ok || !form.checkValidity()) {
            e.preventDefault();
            // Trigger browser UI for invalid fields
            form.reportValidity();
        }
    });
});
</script>